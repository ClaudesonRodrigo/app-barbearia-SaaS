<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento - AgendaBarber</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        .font-title { font-family: 'Playfair Display', serif; }
        .font-body { font-family: 'Inter', sans-serif; }
        .selected-card {
            border-color: #f59e0b; /* amber-500 */
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.5);
        }
    </style>
</head>
<body class="font-body bg-gray-900 text-gray-300 flex flex-col min-h-screen">

    <main class="flex-grow container mx-auto p-4 md:p-8">
        <header id="shop-header" class="text-center mb-10">
            <h1 id="shop-name" class="font-title text-4xl md:text-5xl font-bold text-amber-400">Carregando Barbearia...</h1>
            <p id="shop-address" class="text-gray-400 mt-2"></p>
            <div id="shop-hours" class="text-sm text-amber-300 mt-4 space-x-4"></div>
        </header>
        
        <section id="auth-section" class="text-center mb-8">
            </section>

        <div id="booking-flow">
            </div>

        <section id="details-section" class="mt-16 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <div class="lg:col-span-3">
                    <h2 class="text-2xl font-bold text-white mb-6">Nossa Barbearia</h2>
                    <div id="gallery-container" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        </div>
                </div>
                <div class="lg:col-span-2">
                    <h2 class="text-2xl font-bold text-white mb-6">Onde Estamos</h2>
                    <div id="map-container" class="w-full h-80 bg-gray-800 rounded-lg overflow-hidden">
                        </div>
                </div>
            </div>
        </section>

        <div id="confirmation-message" class="hidden text-center mt-10 bg-green-900 border border-green-500 p-8 rounded-lg max-w-2xl mx-auto">
             </div>
    </main>

    <footer class="text-center p-4 text-gray-500 text-sm">
        </footer>

    <script type="module">
        // --- Todas as importações continuam as mesmas ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, getDocs, query, where, addDoc, Timestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuração e variáveis globais continuam as mesmas ---
        const firebaseConfig = { /* ... seu config ... */ };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        // ... resto das variáveis ...

        // --- Lógica principal continua a mesma ---
        window.onload = async () => {
            // ... código de inicialização ...
        };
        
        // --- FUNÇÕES DE BUSCA E RENDERIZAÇÃO (COM ATUALIZAÇÕES) ---
        async function fetchAndRenderShopDetails(shopId) {
            const shopRef = doc(db, 'shops', shopId);
            const shopSnap = await getDoc(shopRef);

            if (shopSnap.exists()) {
                const shopData = shopSnap.data();
                document.getElementById('shop-name').textContent = shopData.shopName;
                document.getElementById('shop-address').textContent = shopData.address || 'Endereço não informado';
                document.getElementById('shop-name-confirm').textContent = shopData.shopName;

                // NOVO: Renderizar os novos detalhes
                renderOperatingHours(shopData.operatingHours);
                renderGallery(shopData.galleryImages);
                renderMap(shopData.address);
                document.getElementById('details-section').classList.remove('hidden'); // Mostra a seção

                fetchAndRenderServices(shopId);
            } else { throw new Error("Shop not found"); }
        }

        // --- NOVAS FUNÇÕES DE RENDERIZAÇÃO ---

        function renderOperatingHours(hours) {
            if (!hours) return;
            const container = document.getElementById('shop-hours');
            let hoursHTML = '';
            if (hours.weekday) hoursHTML += `<span><strong>Semana:</strong> ${hours.weekday}</span>`;
            if (hours.saturday) hoursHTML += `<span><strong>Sábado:</strong> ${hours.saturday}</span>`;
            if (hours.sunday) hoursHTML += `<span><strong>Domingo:</strong> ${hours.sunday}</span>`;
            container.innerHTML = hoursHTML;
        }

        function renderGallery(images) {
            if (!images || images.length === 0) return;
            const container = document.getElementById('gallery-container');
            container.innerHTML = '';
            images.forEach(imageUrl => {
                const imgWrapper = document.createElement('div');
                imgWrapper.className = 'aspect-square bg-gray-800 rounded-lg overflow-hidden';
                imgWrapper.innerHTML = `<img src="${imageUrl}" alt="Foto da barbearia" class="w-full h-full object-cover hover:scale-110 transition-transform duration-300">`;
                container.appendChild(imgWrapper);
            });
        }

        function renderMap(address) {
            if (!address) return;
            const container = document.getElementById('map-container');
            
            // IMPORTANTE: Você precisa de gerar uma chave de API na plataforma Google Maps
            // e ativar a "Maps Embed API".
            // Visite: https://console.cloud.google.com/google/maps-apis/
            const API_KEY = "SUA_CHAVE_API_DO_Maps"; 

            if (API_KEY === "SUA_CHAVE_API_DO_Maps") {
                container.innerHTML = `<p class="p-4 text-center text-yellow-400">Configure a chave de API do Google Maps para exibir o mapa.</p>`;
                return;
            }

            const iframe = document.createElement('iframe');
            iframe.width = "100%";
            iframe.height = "100%";
            iframe.style.border = 0;
            iframe.loading = "lazy";
            iframe.allowFullscreen = true;
            iframe.src = `https://www.google.com/maps/embed/v1/place?key=${API_KEY}&q=${encodeURIComponent(address)}`;
            container.innerHTML = '';
            container.appendChild(iframe);
        }


        // --- O RESTO DO SEU SCRIPT CONTINUA AQUI ---
        // (onAuthStateChanged, getRedirectResult, addEventListeners, etc... tudo igual)
        
    </script>
</body>
</html>
